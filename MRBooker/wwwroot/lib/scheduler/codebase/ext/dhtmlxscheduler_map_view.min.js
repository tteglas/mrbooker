/*
@license
dhtmlxScheduler v.5.0.0 Stardard
This software is covered by GPL license. You also can obtain Commercial or Enterprise license to use it in non-GPL project - please contact sales@dhtmlx.com. Usage without proper license is prohibited.
(c) Dinamenta, UAB.
*/
scheduler.xy.map_date_width=188;scheduler.xy.map_icon_width=25;scheduler.xy.map_description_width=400;scheduler.config.map_resolve_event_location=!0;scheduler.config.map_resolve_user_location=!0;scheduler.config.map_initial_position=new google.maps.LatLng(48.724,8.215);scheduler.config.map_error_position=new google.maps.LatLng(15,15);scheduler.config.map_infowindow_max_width=300;scheduler.config.map_type=google.maps.MapTypeId.ROADMAP;scheduler.config.map_zoom_after_resolve=15;scheduler.locale.labels.marker_geo_success="It seems you are here.";scheduler.locale.labels.marker_geo_fail="Sorry, could not get your current position using geolocation.";scheduler.templates.marker_date=scheduler.date.date_to_str("%Y-%m-%d %H:%i");scheduler.templates.marker_text=function(n,t,i){return"<div><b>"+i.text+"<\/b><br/><br/>"+(i.event_location||"")+"<br/><br/>"+scheduler.templates.marker_date(n)+" - "+scheduler.templates.marker_date(t)+"<\/div>"};scheduler.dblclick_dhx_map_area=function(){!this.config.readonly&&this.config.dblclick_create&&this.addEventNow({start_date:scheduler._date,end_date:scheduler.date.add(scheduler._date,scheduler.config.time_step,"minute")})};scheduler.templates.map_time=function(n,t,i){return i._timed?this.day_date(i.start_date,i.end_date,i)+" "+this.event_date(n):scheduler.templates.day_date(n)+" &ndash; "+scheduler.templates.day_date(t)};scheduler.templates.map_text=function(n,t,i){return i.text};scheduler.date.map_start=function(n){return n};scheduler.date.add_map=function(n){return new Date(n.valueOf())};scheduler.templates.map_date=function(){return""};scheduler._latLngUpdate=!1;scheduler.attachEvent("onSchedulerReady",function(){function l(n){if(n){var t=scheduler.locale.labels;scheduler._els.dhx_cal_header[0].innerHTML="<div class='dhx_map_line' style='width: "+(scheduler.xy.map_date_width+scheduler.xy.map_description_width+2)+"px;' ><div class='headline_date' style='width: "+scheduler.xy.map_date_width+"px;'>"+t.date+"<\/div><div class='headline_description' style='width: "+scheduler.xy.map_description_width+"px;'>"+t.description+"<\/div><\/div>";scheduler._table_view=!0;scheduler.set_sizes()}}function a(){var t,n;scheduler._selected_event_id=null;scheduler.map._infowindow.close();t=scheduler.map._markers;for(n in t)t.hasOwnProperty(n)&&(t[n].setMap(null),delete scheduler.map._markers[n],scheduler.map._infowindows_content[n]&&delete scheduler.map._infowindows_content[n])}function f(){var r=scheduler.get_visible_events(),u,t;r.sort(function(n,t){return n.start_date.valueOf()==t.start_date.valueOf()?n.id>t.id?1:-1:n.start_date>t.start_date?1:-1});for(var f=scheduler._waiAria.mapAttrString(),i="<div "+f+" class='dhx_map_area'>",t=0;t<r.length;t++){var n=r[t],e=n.id==scheduler._selected_event_id?"dhx_map_line highlight":"dhx_map_line",o=n.color?"background:"+n.color+";":"",s=n.textColor?"color:"+n.textColor+";":"",f=scheduler._waiAria.mapRowAttrString(n),h=scheduler._waiAria.mapDetailsBtnString();i+="<div "+f+" class='"+e+"' event_id='"+n.id+"' style='"+o+s+(n._text_style||"")+" width: "+(scheduler.xy.map_date_width+scheduler.xy.map_description_width+2)+"px;'><div class='dhx_map_event_time' style='width: "+scheduler.xy.map_date_width+"px;' >"+scheduler.templates.map_time(n.start_date,n.end_date,n)+"<\/div>";i+="<div "+h+" class='dhx_event_icon icon_details'>&nbsp;<\/div>";i+="<div class='line_description' style='width:"+(scheduler.xy.map_description_width-scheduler.xy.map_icon_width)+"px;'>"+scheduler.templates.map_text(n.start_date,n.end_date,n)+"<\/div><\/div>"}for(i+="<div class='dhx_v_border' style='left: "+(scheduler.xy.map_date_width-2)+"px;'><\/div><div class='dhx_v_border_description'><\/div><\/div>",scheduler._els.dhx_cal_data[0].scrollTop=0,scheduler._els.dhx_cal_data[0].innerHTML=i,scheduler._els.dhx_cal_data[0].style.width=scheduler.xy.map_date_width+scheduler.xy.map_description_width+1+"px",u=scheduler._els.dhx_cal_data[0].firstChild.childNodes,scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[scheduler._mode+"_date"](scheduler._min_date,scheduler._max_date,scheduler._mode),scheduler._rendered=[],t=0;t<u.length-2;t++)scheduler._rendered[t]=u[t]}function e(n){var t=document.getElementById(n),r=scheduler._y-scheduler.xy.nav_height,i;0>r&&(r=0);i=scheduler._x-scheduler.xy.map_date_width-scheduler.xy.map_description_width-1;0>i&&(i=0);t.style.height=r+"px";t.style.width=i+"px";t.style.marginLeft=scheduler.xy.map_date_width+scheduler.xy.map_description_width+1+"px";t.style.marginTop=scheduler.xy.nav_height+2+"px"}var t,o,s,n,r,h,c,i;scheduler._isMapPositionSet=!1;t=document.createElement("div");t.className="dhx_map";t.id="dhx_gmap";t.style.dispay="none";o=scheduler._obj;o.appendChild(t);scheduler._els.dhx_gmap=[];scheduler._els.dhx_gmap.push(t);e("dhx_gmap");s={zoom:scheduler.config.map_inital_zoom||10,center:scheduler.config.map_initial_position,mapTypeId:scheduler.config.map_type||google.maps.MapTypeId.ROADMAP};n=new google.maps.Map(document.getElementById("dhx_gmap"),s);n.disableDefaultUI=!1;n.disableDoubleClickZoom=!scheduler.config.readonly;google.maps.event.addListener(n,"dblclick",function(n){if(!scheduler.config.readonly&&scheduler.config.dblclick_create){var t=n.latLng;geocoder.geocode({latLng:t},function(n,i){i==google.maps.GeocoderStatus.OK&&(t=n[0].geometry.location,scheduler.addEventNow({lat:t.lat(),lng:t.lng(),event_location:n[0].formatted_address,start_date:scheduler._date,end_date:scheduler.date.add(scheduler._date,scheduler.config.time_step,"minute")}))})}});r={content:""};scheduler.config.map_infowindow_max_width&&(r.maxWidth=scheduler.config.map_infowindow_max_width);scheduler.map={_points:[],_markers:[],_infowindow:new google.maps.InfoWindow(r),_infowindows_content:[],_initialization_count:-1,_obj:n};geocoder=new google.maps.Geocoder;scheduler.config.map_resolve_user_location&&navigator.geolocation&&(scheduler._isMapPositionSet||navigator.geolocation.getCurrentPosition(function(t){var i=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);n.setCenter(i);n.setZoom(scheduler.config.map_zoom_after_resolve||10);scheduler.map._infowindow.setContent(scheduler.locale.labels.marker_geo_success);scheduler.map._infowindow.position=n.getCenter();scheduler.map._infowindow.open(n);scheduler._isMapPositionSet=!0},function(){scheduler.map._infowindow.setContent(scheduler.locale.labels.marker_geo_fail);scheduler.map._infowindow.setPosition(n.getCenter());scheduler.map._infowindow.open(n);scheduler._isMapPositionSet=!0}));google.maps.event.addListener(n,"resize",function(){t.style.zIndex="5";n.setZoom(n.getZoom())});google.maps.event.addListener(n,"tilesloaded",function(){t.style.zIndex="5"});t.style.display="none";scheduler.attachEvent("onSchedulerResize",function(){return"map"==this._mode?(this.map_view(!0),!1):!0});h=scheduler.render_data;scheduler.render_data=function(){if("map"!=this._mode)return h.apply(this,arguments);f();for(var t=scheduler.get_visible_events(),n=0;n<t.length;n++)scheduler.map._markers[t[n].id]||i(t[n],!1,!1)};scheduler.map_view=function(n){var u,o,r,t;if(scheduler.map._initialization_count++,o=scheduler._els.dhx_gmap[0],scheduler._els.dhx_cal_data[0].style.width=scheduler.xy.map_date_width+scheduler.xy.map_description_width+1+"px",scheduler._min_date=scheduler.config.map_start||scheduler._currentDate(),scheduler._max_date=scheduler.config.map_end||scheduler.date.add(scheduler._currentDate(),1,"year"),scheduler._table_view=!0,l(n),n)for(a(),f(),o.style.display="block",e("dhx_gmap"),u=scheduler.map._obj.getCenter(),r=scheduler.get_visible_events(),t=0;t<r.length;t++)scheduler.map._markers[r[t].id]||i(r[t]);else o.style.display="none";google.maps.event.trigger(scheduler.map._obj,"resize");0===scheduler.map._initialization_count&&u&&scheduler.map._obj.setCenter(u);scheduler._selected_event_id&&c(scheduler._selected_event_id)};c=function(n){scheduler.map._obj.setCenter(scheduler.map._points[n]);scheduler.callEvent("onClick",[n])};i=function(n,t,i){var r=scheduler.config.map_error_position,u;n.lat&&n.lng&&(r=new google.maps.LatLng(n.lat,n.lng));u=scheduler.templates.marker_text(n.start_date,n.end_date,n);scheduler._new_event||(scheduler.map._infowindows_content[n.id]=u,scheduler.map._markers[n.id]&&scheduler.map._markers[n.id].setMap(null),scheduler.map._markers[n.id]=new google.maps.Marker({position:r,map:scheduler.map._obj}),google.maps.event.addListener(scheduler.map._markers[n.id],"click",function(){scheduler.map._infowindow.setContent(scheduler.map._infowindows_content[n.id]);scheduler.map._infowindow.open(scheduler.map._obj,scheduler.map._markers[n.id]);scheduler._selected_event_id=n.id;scheduler.render_data()}),scheduler.map._points[n.id]=r,t&&scheduler.map._obj.setCenter(scheduler.map._points[n.id]),i&&scheduler.callEvent("onClick",[n.id]))};scheduler.attachEvent("onClick",function(n){if("map"==this._mode){scheduler._selected_event_id=n;for(var t=0;t<scheduler._rendered.length;t++)scheduler._rendered[t].className="dhx_map_line",scheduler._rendered[t].getAttribute("event_id")==n&&(scheduler._rendered[t].className+=" highlight");scheduler.map._points[n]&&scheduler.map._markers[n]&&(scheduler.map._obj.setCenter(scheduler.map._points[n]),google.maps.event.trigger(scheduler.map._markers[n],"click"))}return!0});var u=function(n){n.event_location&&geocoder?geocoder.geocode({address:n.event_location,language:scheduler.uid().toString()},function(t,r){var u={};r!=google.maps.GeocoderStatus.OK?(u=scheduler.callEvent("onLocationError",[n.id]),u&&u!==!0||(u=scheduler.config.map_error_position)):u=t[0].geometry.location;n.lat=u.lat();n.lng=u.lng();scheduler._selected_event_id=n.id;scheduler._latLngUpdate=!0;scheduler.callEvent("onEventChanged",[n.id,n]);i(n,!0,!0)}):i(n,!0,!0)},v=function(n){n.event_location&&geocoder&&geocoder.geocode({address:n.event_location,language:scheduler.uid().toString()},function(t,i){var r={};i!=google.maps.GeocoderStatus.OK?(r=scheduler.callEvent("onLocationError",[n.id]),r&&r!==!0||(r=scheduler.config.map_error_position)):r=t[0].geometry.location;n.lat=r.lat();n.lng=r.lng();scheduler._latLngUpdate=!0;scheduler.callEvent("onEventChanged",[n.id,n])})},y=function(n,t,i,r){setTimeout(function(){var r=n.apply(t,i);return n=t=i=null,r},r||1)};scheduler.attachEvent("onEventChanged",function(n){if(this._latLngUpdate)this._latLngUpdate=!1;else{var t=scheduler.getEvent(n);t.start_date<scheduler._min_date&&t.end_date>scheduler._min_date||t.start_date<scheduler._max_date&&t.end_date>scheduler._max_date||t.start_date.valueOf()>=scheduler._min_date&&t.end_date.valueOf()<=scheduler._max_date?(scheduler.map._markers[n]&&scheduler.map._markers[n].setMap(null),u(t)):(scheduler._selected_event_id=null,scheduler.map._infowindow.close(),scheduler.map._markers[n]&&scheduler.map._markers[n].setMap(null))}return!0});scheduler.attachEvent("onEventIdChange",function(n,t){var i=scheduler.getEvent(t);return(i.start_date<scheduler._min_date&&i.end_date>scheduler._min_date||i.start_date<scheduler._max_date&&i.end_date>scheduler._max_date||i.start_date.valueOf()>=scheduler._min_date&&i.end_date.valueOf()<=scheduler._max_date)&&(scheduler.map._markers[n]&&(scheduler.map._markers[n].setMap(null),delete scheduler.map._markers[n]),scheduler.map._infowindows_content[n]&&delete scheduler.map._infowindows_content[n],u(i)),!0});scheduler.attachEvent("onEventAdded",function(n,t){return scheduler._dataprocessor||(t.start_date<scheduler._min_date&&t.end_date>scheduler._min_date||t.start_date<scheduler._max_date&&t.end_date>scheduler._max_date||t.start_date.valueOf()>=scheduler._min_date&&t.end_date.valueOf()<=scheduler._max_date)&&(scheduler.map._markers[n]&&scheduler.map._markers[n].setMap(null),u(t)),!0});scheduler.attachEvent("onBeforeEventDelete",function(n){return scheduler.map._markers[n]&&scheduler.map._markers[n].setMap(null),scheduler._selected_event_id=null,scheduler.map._infowindow.close(),!0});scheduler._event_resolve_delay=1500;scheduler.attachEvent("onEventLoading",function(n){return scheduler.config.map_resolve_event_location&&n.event_location&&!n.lat&&!n.lng&&(scheduler._event_resolve_delay+=1500,y(v,this,[n],scheduler._event_resolve_delay)),!0});scheduler.attachEvent("onEventCancel",function(n,t){return t&&(scheduler.map._markers[n]&&scheduler.map._markers[n].setMap(null),scheduler.map._infowindow.close()),!0})});