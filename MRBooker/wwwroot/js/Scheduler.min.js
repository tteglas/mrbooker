$(document).ready(function(){function r(n){$("#roomId").val(n).trigger("change")}var t,i,n;$("#RoomId").change(function(){var n=$("#RoomId option:selected").val();r(n)});t=[];$.getJSON("api/reservationApi/GetAllRooms",function(n){$.each(n,function(n,i){t.push(i)})});scheduler.config.xml_date="%Y/%m/%d %h:%i:%s";scheduler.config.limit_time_select=!0;scheduler.config.first_hour=8;scheduler.config.last_hour=22;scheduler.config.server_utc=!1;scheduler.config.readonly=!1;scheduler.locale.labels.map_tab="Map";i=[{key:$("#RoomId option:selected").val(),label:$("#RoomId option:selected").text()}];n=[{name:"Title",height:30,map_to:"title",type:"textarea",focus:!0},{name:"Description",height:60,map_to:"description",type:"textarea"},{name:"Status",height:30,map_to:"status",type:"textarea"},{name:"room",height:58,options:i,map_to:"room",type:"radio",vertical:!0},{name:"time",height:72,type:"time",map_to:"auto",time_format:["%H:%i","%d","%m","%Y"]}];scheduler.templates.event_bar_text=function(n,t,i){return"<b>"+i.title+"<\/b>"};scheduler.templates.tooltip_text=function(n,t,i){return"<b>Event:<\/b> "+i.title+"<br/><b>Start date:<\/b> "+scheduler.templates.tooltip_date_format(n)+"<br/><b>End date:<\/b> "+scheduler.templates.tooltip_date_format(t)};scheduler.locale.labels.section_room="Room";scheduler.config.lightbox.sections=n;scheduler.load("api/reservationApi/GetAll","json");scheduler.init("main_scheduler",new Date,"month");$("#roomId").change(function(){scheduler.load("api/reservationApi/GetReservationByRoom/?roomId="+$("#roomId").val(),"json");scheduler.clearAll();scheduler.setCurrentView()});scheduler.attachEvent("onBeforeDrag",function(){return $("#RoomId option:selected").text()==="All Rooms"?(dhtmlx.message({title:"Room",type:"alert-warning",text:"Please select a room before reservation"}),!1):!0});scheduler.attachEvent("onBeforeLightbox",function(){return scheduler.resetLightbox(),n=[{name:"Title",height:30,map_to:"title",type:"textarea",focus:!0},{name:"Description",height:60,map_to:"description",type:"textarea"},{name:"Status",height:30,map_to:"status",type:"textarea"},{name:"room",height:58,options:t,map_to:"roomId",type:"select"},{name:"time",height:72,type:"time",map_to:"auto",time_format:["%H:%i","%d","%m","%Y"]}],scheduler.config.lightbox.sections=n,!0});scheduler.attachEvent("onEventSave",function(n,t,i){i?$.ajax({url:"api/reservationApi/insert",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(){dhtmlx.message({title:"Reservation",type:"alert-info",text:"Reservation has been saved.",callback:function(){scheduler.clearAll();scheduler.load("api/reservationApi/GetReservationByRoom/?roomId="+$("#roomId").val(),"json");scheduler.endLightbox(!1,$(".dhx_cal_light").get(0))}})},error:function(n){return n.status==500?dhtmlx.message({title:"Server failure !",type:"alert-error",text:"Server has failed processing the request."}):n.status==401?dhtmlx.message({title:"Authorization failure !",type:"alert-error",text:"You are not authorized to perform this action."}):n.status==403?dhtmlx.message({title:"Invalid reservation !",type:"alert-error",text:"Your reservation is invalid. Please check again."}):dhtmlx.message({title:"Reservation",type:"alert-error",text:"Something went wrong. Please try again."}),!1}}):(scheduler.updateEvent(n),scheduler.callEvent("onEventChanged",[n,t]))});scheduler.attachEvent("onEventChanged",function(n,t){var i=[{id:n,start_date:t.start_date,end_date:t.end_date,description:t.description,status:t.status,title:t.title,roomId:t.roomId}];$.ajax({url:"api/reservationApi/update",type:"PUT",contentType:"application/json; charset=utf-8",data:JSON.stringify(i[0]),success:function(){return dhtmlx.message({title:"Reservation",type:"alert-info",text:"Reservation has been updated.",callback:function(){scheduler.endLightbox(!1,$(".dhx_cal_light").get(0));scheduler.load("api/reservationApi/GetReservationByRoom/?roomId="+$("#roomId").val(),"json");scheduler.clearAll();scheduler.setCurrentView()}}),!0},error:function(n){return n.status==500?dhtmlx.message({title:"Server failure !",type:"alert-error",text:"Server has failed processing the request."}):n.status==401?dhtmlx.message({title:"Authorization failure !",type:"alert-error",text:"You are not authorized to perform this action."}):n.status==403?dhtmlx.message({title:"Invalid reservation !",type:"alert-error",text:"Your reservation is invalid. Please check again."}):n.status==404?dhtmlx.message({title:"Not found !",type:"alert-error",text:"The reservation you are trying to update was not found."}):dhtmlx.message({title:"Reservation",type:"alert-error",text:"Something went wrong. Please try again."}),!1}})});scheduler.attachEvent("onEventDeleted",function(n){scheduler.getState().new_event||$.ajax({url:"api/reservationApi/delete/?="+n,type:"DELETE",contentType:"application/json; charset=utf-8",success:function(n){return console.log("success !"+n),!0},error:function(n){return n.status==500?dhtmlx.message({title:"Server failure !",type:"alert-error",text:"Server has failed processing the request."}):n.status==401?dhtmlx.message({title:"Authorization failure !",type:"alert-error",text:"You are not authorized to perform this action."}):n.status==404?dhtmlx.message({title:"Not found !",type:"alert-error",text:"The reservation you are trying to delete was not found."}):dhtmlx.message({title:"Reservation",type:"alert-error",text:"Something went wrong. Please try again."}),!1}})})});